{% extends "wms/base_boot.html" %}
{% load staticfiles %}
{% block content %}
    <link href="{%static 'wms/css/fullcalendar/fullcalendar.css'%}" rel="stylesheet">
    <script src="{%static 'wms/js/fullcalendar/moment.min.js'%}"></script>
    <script src="{%static 'wms/js/fullcalendar/fullcalendar.js'%}"></script>
    <div class="col-md-9 panel panel-default" >
        <div  id="calendar">
            <script type="text/javascript">

                var event_list =[
                                {%for event in events%}
                                    {
                                        title : '{{event.title}}',
                                        start : '{{event.startDateTime|date:"c"}}',
                                        end : '{{event.endDateTime|date:"c"}}',
                                    {% if event.type == "client" %}
                                        backgroundColor : '#16a085',
                                    {% elif event.type == "fa" %}
                                        backgroundColor : '#8e44ad',
                                    {% elif event.type == "pot_client" %}
                                        backgroundColor : '#d35400',
                                    {% elif event.type == "holiday"%}
                                        backgroundColor : '#c0392b'
                                    {% endif %}

                                    },
                                {% endfor %}
                            ];

                function post(eventData){
                    $.ajax({
                                url: "create_appointment/",
                                type: "POST",
                                data: eventData,

                                success: function (json) {
                                    console.log("Success");
                                    alert('Successfully called');
                                    $('#calendar').fullCalendar('renderEvent', eventData, true);
                                },

                                error: function (xhr, errmsg, err) {
                                    alert('fail called');
                                    console.log(xhr.status + ": " + xhr.responseText);

                                }

                            }
                    )
                }

                $(document).ready(function(){
                        $('#calendar').fullCalendar({
                            header:{
                                left: 'prev,next today',
                                center: 'title',
                                right: 'agendaDay, agendaWeek, month'
                            },
                            defaultView: 'agendaWeek',
                            editable: true,
                            allDaySlot: false,
                            selectable: true,

                            select: function(start, end) {
                            var title = prompt('Event Title:');
                            var eventData;
                            if (title) {
                                eventData = {
                                    'title': title,
                                    'start': start,
                                    'end': end
                                };
                                post(eventData)


                            }
                            $('#calendar').fullCalendar('unselect');
                            },
                            events: event_list

                        })


                });

            </script>
        </div>
        <div class="col-md-3">

        </div>


    </div>
{% endblock %}