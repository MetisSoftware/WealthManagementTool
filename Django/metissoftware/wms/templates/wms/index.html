{% extends "wms/base_boot.html" %}
{% load staticfiles %}
{% block content %}
{% if stock_json %}
    <div id="stock_info" class="col-md-12 well">
    <div class="col-md-3" ></div>
        <div class="col-md-6 text-center" style="padding-top: 10">
            <div class="col-md-4" >
                <p class="stockTitle "  >Buy at: {{ stock_json.0.Close }}</p>
            </div>
            <div class="col-md-4">
                <p class="text-uppercase" style="font-size: 150%">
                    <script>document.write("{{ symbol }}".toUpperCase());</script>
                <p>
            </div>
            <div class="col-md-4">
                <p id="stockGrowth" class="stockTitle bottom-align-text">
                   <script>
                        var change = ({{stock_json.0.Close}} - {{stock_json.1.Close}}).toFixed(2);
                        var growth = ((change/ {{stock_json.1.Close}})*100).toFixed(2);

                        if (growth > 0){
                            document.getElementById("stockGrowth").style.color = "green";
                            document.write('&#x25B2;');

                        }else if(growth < 0){
                            document.getElementById("stockGrowth").style.color = "red";
                            document.write('&#x25BC;');
                        }else{
                            document.getElementById("stockGrowth").style.color = "white";
                            document.write('&#9654;');
                        }
                        document.write(Math.abs(change) +" ("+growth+"%)");

                    </script>
                </p>
            </div>

        </div>
        <div class="col-md-3" style="padding-top: 5">
                <form class="form-inline "action="" method="get">
                    <div class="col-md-10">
                        <label class="sr-only">Stock Symbol</label>
                        <input id="symbol_input" class="form-control" type="text" name="symbol" placeholder="Stock Symbol"/>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-default " type="submit" value="Submit" >Go</button>
                    </div>


                </form>
        </div>
        <div class="col-md-11">
            <canvas id="stock_graph" ></canvas>
        </div>
        <div class="col-md-1">
            <div id="lineLegend" ></div>
        </div>

    </div>

    <div class="table-responsive col-md-12 well">
        <h1 class="text-center" style="color: #000000">Results</h1>
        <table class = "table table-hover table-condensed table-bordered" style="background-color: #ffffff">

        {% for key in stock_json.0 %}
            <th>{{ key }}</th>
        {% endfor %}
        <tbody >
            {% for result in stock_json %}
                <tr>
                    {% for key,data in result.items %}
                        <td>{{ data }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>


        </table>
    </div>


    <script>


    var dates = [];
    var open = [];
    var close = [];
	var high = [];
	var low = [];

    {% for result in stock_json reversed%}
        dates[dates.length] = "{{result.Date}}";
        open[open.length] = "{{ result.Open }}";
        close[close.length] = "{{ result.Close }}";
		high[high.length] = "{{ result.High }}";
		low[low.length] = "{{ result.Low }}";
    {% endfor %}

    var stock_graph = document.getElementById('stock_graph').getContext('2d');
    var stockData = {
	labels : dates,
	datasets : [
		{
            label : "Open",
			fillColor : "rgba(223,181,17,0)",
			strokeColor : "#DFB511",
			pointColor : "#DFB511",
			pointStrokeColor : "#34495e",
			data : open
		},
         {
            label : "Close",
			fillColor : "rgba(0,107,195,0)",
			strokeColor : "#006BC3",
			pointColor : "#006BC3",
			pointStrokeColor : "#34495e",
			data : close
		},
		{
            label : "High",
			fillColor : "rgba(9,192,9,0)",
			strokeColor : "#09C009",
			pointColor : "#09C009",
			pointStrokeColor : "#34495e",
			data : high
		},
		{
            label : "Low",
			fillColor : "rgba(218,7,7,0)",
			strokeColor : "#DA0707",
			pointColor : "#DA0707",
			pointStrokeColor : "#34495e",
			data : low
		}

	]
    }
    var opts = {scaleFontColor: "#000000",
        scaleLineColor: "#000000",
        scaleGridLineColor: "#000000",
        scaleShowLabels: true,
        bezierCurve: false,
        scaleShowVerticalLines: false,
        responsive: true
    }

    new Chart(stock_graph).Line(stockData, opts);
    legend(document.getElementById("lineLegend"),stockData);
</script>


{% endif %}
{%  endblock %}
